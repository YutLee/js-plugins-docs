/*
 Copyright 2013
 jQuery popup v1.0

 @author yutlee.cn@gmail.com
 Date 2013-7-13
*/
(function(d,b,r){b.Popup=function(){function u(a){this.options=d.extend({id:null,url:"",datatype:"json",closeCall:null,successCall:function(){d.browser.msie&&10>d.browser.version&&d("input[type=text],input[type=password],textarea").each(function(a,b){var c=d(this).attr("placeholder");c&&""!==d.trim(c)&&d(this).placeholder({isUseSpan:!0})})},scrollTop:!1,title:"\u6e29\u99a8\u63d0\u793a",width:400,height:"auto",animate:!0,full:null,style:""},a||{});b.top.popup===r&&(b.top.popup=[]);b.top.popupIframe===
r&&(b.top.popupIframe=[])}function n(a){return"function"===typeof a}function s(){c=d('<div class="popup" />');p=d('<div class="title" />');f=d('<div class="close" />');h=d('<div class="container" />')}function v(a){a.showBefore(c);f=f.html("\u00d7").appendTo(c);p.html(a.options.title).appendTo(c);(q=a.options.id)?(w=q.parent(),h.append(q.show()).appendTo(c)):h.html(t).appendTo(c);c=c.css({display:"none"}).appendTo("body");a.setStyle(c);a.options.full||a.position(c);c.fadeIn();a._close(a.callback)}
function y(a,e){d(b).bind({"resize.popup":function(){clearTimeout(x);x=setTimeout(function(){a.position(e)},100)}})}var c,p,m,f,h,q,w,x,t="";b.top.popupArray||(b.top.popupArray=[]);u.prototype={init:function(){b.top.popup===r&&(b.top.popup=[]);b.top.popup.push(this)},tempHtml:[],loadInto:function(a){var e=d.extend({url:"",temps:"",successCall:null},a||{});bt.request({url:e.url,temps:e.temps,isHistory:!1,callback:function(a){t=bt.getCompleteHtml(a);bt.loadCss(a.css_url);bt.loadJs(a.js_url);h.html(t);
n(e.successCall)&&e.successCall.apply(that);return!1}})},getData:function(){var a=this,e=app.bitty;s();m=d('<div class="popup_shadow" />').appendTo("body");e.request({url:a.options.url,temps:a.options.temps,isHistory:!1,callback:function(b){t=e.getCompleteHtml(b);e.loadCss(b.css_url);e.loadJs(b.js_url);v(a);n(a.options.successCall)&&a.options.successCall.apply(a);return!1}})},getHtml:function(a){var b=this;d.ajax({url:a,success:function(a){b.showBefore(c);f=f.html("\u00d7").appendTo(c);p.html(b.options.title).appendTo(c);
h.html(a).appendTo(c);b.temp=c=c.css({display:"none"}).appendTo("body");b.setStyle(c);b.options.full||b.position(c);c.fadeIn();b._close(b.callback);n(b.options.successCall)&&b.options.successCall.apply(b)}})},getIframe:function(a){this.showBefore(c);f=f.html("\u00d7").appendTo(c);p.html(this.options.title).appendTo(c);h.html('<iframe scrolling="no" frameborder="0" width="100%" height="100%" src="'+a+'"></iframe>').appendTo(c);this.temp=c=c.css({display:"none"}).appendTo(d(b.parent.document.body));
this.setStyle(c);this.options.full||this.position(c);c.fadeIn();this._close(this.callback)},showBefore:function(a){var b=this.options.width,c=this.options.height;b&&"auto"===b&&a.css({visibility:"hidden",display:"block",position:"relative",width:"auto",right:"auto",left:"auto"});c&&"auto"===c&&a.css({visibility:"hidden",display:"block",position:"relative",height:"auto",top:"auto",bottom:"auto"})},setStyle:function(a){var b=this.options.width,c=this.options.height,k=this.options.full,l=this.options.style;
""!==d.trim(l)&&(a.addClass(l),m.addClass(l));"absolute"!==a.css("position")&&a.css({position:"absolute"});"auto"===a.css("z-index")&&a.css({"z-index":9999});k?(b=k.top,c=k.right,l=k.bottom,k=k.left,a.css({width:"auto",height:"auto",top:b||0==b?b:"auto",right:c||0==c?c:"auto",bottom:l||0==l?l:"auto",left:k||0==k?k:"auto"}),d("html").css({overflow:"hidden"})):(b&&"auto"===b?a.css({width:h.width(),display:"none",visibility:"visible"}):a.width(b),c&&"auto"===c?a.css({height:a.height(),display:"none",
visibility:"visible",position:"absolute"}):a.height(c));h.height(a.height()-p.outerHeight())},position:function(a){var c=d(b.top).width(),g=d(b.top).height(),c=0.5*(c-a.outerWidth()),g=0.5*(g-a.outerHeight())+d(b).scrollTop();a.animate({left:0<c?c:0,top:0<g?g:0},100)},open:function(){var a;b.top.popup===r&&(b.top.popup=[]);b.top.popup.unshift(this);this.options.id?(b.top.shadowArray||(m=d('<div class="popup_shadow" />').appendTo("body")),s(),v(this),this.options.full||y(this,c),a=""):"iframe"===this.options.datatype?
(b.top.shadowArray||(m=d('<div class="popup_shadow" />').appendTo(d(b.parent.document.body))),s(),this.getIframe(this.options.url),a=c.find("iframe")[0]):"json"===this.options.datatype?(this.getData(),a=""):"html"===this.options.datatype&&(b.top.shadowArray||(m=d('<div class="popup_shadow" />').appendTo("body")),s(),this.getHtml(this.options.url),a="");if(b.top.shadowArray){var e=b.top.popupArray[b.top.popupArray.length-1],g=b.top.shadowArray.css("z-index");e.css({"z-index":g-1})}b.top.popupIframe.unshift(a);
b.top.popupArray.push(c);b.top.shadowArray=m?m:b.top.shadowArray},reload:function(){var a=this;"iframe"===a.options.datatype?(a.temp.find("iframe").attr("src",a.options.url),a.setStyle(a.temp),a.options.full||a.position(a.temp)):"json"===a.options.datatype?a.getData():"html"===a.options.datatype&&d.ajax({url:a.options.url,success:function(b){a.temp.find(".container").html(b);a.setStyle(a.temp);a.options.full||a.position(a.temp);n(a.options.successCall)&&a.options.successCall.apply(a)}})},_close:function(){var a=
this,c=b.top.shadowArray?b.top.shadowArray:m;f.bind({click:function(){a._dele();return!1}});c.unbind("click.shadow");c.bind({"click.shadow":function(){a._dele();return!1}})},_dele:function(){function a(){g.callClose();k.remove();c.remove();b.top.shadowArray=null;b.top.popupIframe=[];b.top.popupArray=[];d(b).unbind("resize.popup");b.top.popup.shift()}function e(){g.callClose();h.css({"z-index":h.css("z-index")+2});f.remove();b.top.popupIframe.shift();b.top.popupArray.pop();b.top.popup.shift()}var g=
this,k=b.top.shadowArray?b.top.shadowArray:m,l=b.top.popupArray.length,f=b.top.popupArray[l-1],h=b.top.popupArray[l-2],f=f?f:c,h=h?h:c;q&&q.hide().appendTo(w);f.fadeOut();1===l?(k.fadeOut(),g.options.animate?f.queue(function(){a()}):a()):1<l&&(g.options.animate?f.queue(function(){e()}):e());n(g.options.closeCall)&&g.options.closeCall.apply(g);d("html").css({"overflow-y":"scroll"})},close:function(){"[object Array]"===Object.prototype.toString.call(b.top.popup)&&0<b.top.popup.length&&this._dele()},
callClose:function(a){n(a)&&a.apply(this)}};return u}()})(jQuery,window);
