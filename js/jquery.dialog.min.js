/*
 Copyright 2013

 @author yutlee.cn@gmail.com
 Date 2013-10-12 
*/
(function(b,f,A){function t(){l||(l=b(x).appendTo("body"),g=l.prev(".modal-dialog"),g.children(".dialog-title"),n=g.children(".dialog-content"),u=g.children(".dialog-button"),h=u.children().first(),c=u.children().last(),k=g.children(".dialog-close"),g.next(".modal-dialog-overlay"));l.hide();h.show()}function B(){var a=b(f).width(),e=b(f).height(),d=g.outerWidth(),h=g.outerHeight(),y=b(f).scrollTop(),c=b(f).scrollLeft();g.css({top:0.5*(e-h)+y,left:0.5*(a-d)+c});l.show();b(f).bind({"scroll.dialog":function(){b(f).scrollTop(y);
b(f).scrollLeft(c)},"keydown.dialog":function(a){if(9!==a.keyCode||13!==a.keyCode||27!==a.keyCode)return!1}})}function r(a,e){e||""==e?(n.empty().append("<div>"+a+"</div>"),v=b('<input class="dialog-input" type="text" name="prompt" tabIndex="10000" value="'+e+'" />').appendTo(n)):(console.log(a),a=a===A?"undefined":a,n.empty().text(a));B();p=!0}function s(){l.hide();n.empty();c.unbind("click");h.unbind("click");k.unbind("click");b(document).unbind("keydown.dialogEsc");b(document).unbind("keydown.dialogTab");
c.unbind("keydown.dialogEnter");h.unbind("keydown.dialogEnter");b(f).unbind("scroll.dialog");b(f).unbind("keydown.dialog");p=!1}function q(a,e){a.bind({click:function(){s();b.isFunction(e)&&e.call(this)}})}function w(a,e,d,c){c?(c.focus().select(),c.bind({keydown:function(b){13===b.keyCode&&a.click()}})):setTimeout(function(){a.focus()},20);b(document).bind({"keydown.dialogEsc":function(a){27===a.keyCode&&e.click()},"keydown.dialogTab":function(b){9===b.keyCode&&(d?c?setTimeout(function(){d.blur(function(){c.focus()})},
1):setTimeout(function(){d.blur(function(){a.focus()})},1):setTimeout(function(){a.focus()},1))}});a.bind({"keydown.dialogEnter":function(b){13===b.keyCode&&a.click()}});d&&d.bind({"keydown.dialogEnter":function(a){13===a.keyCode&&d.click()}})}function m(a){a&&b.isFunction(a)||(a=b.noop);return a}var z=f.app=f.app||{},x,v,l,g,n,u,h,c,k,p=!1;z.dialog={setup:function(a){a=b.extend({dialogClass:"",overlayClass:"",title:"\u6e29\u99a8\u63d0\u793a",ok:"\u786e\u5b9a",cancel:"\u53d6\u6d88"},a||{});x=b('<div class="modal-dialog '+
a.dialogClass+'"><div class="dialog-close">\u00d7</div><div class="dialog-title">'+a.title+'</div><div class="dialog-content"></div> <div class="dialog-button"><button class="play-button" tabIndex="10002">'+a.cancel+'</button> <button class="play-button" tabIndex="10001">'+a.ok+'</button></div></div><div class="modal-dialog-overlay '+a.overlayClass+'"></div>')},alert:function(a){if(p)return!1;t();h.hide();r(a);c.bind({click:function(){s()}});q(k);w(c,k)},confirm:function(a,b,d){if(p)return!1;t();
r(a);b=m(b);d=m(d);c.bind({click:function(){s();b.call(this)}});q(h,d);q(k,d);w(c,k,h)},prompt:function(a,e,d,f){if(p)return!1;var g;t();b.isFunction(e)?(r(a,""),g=m(e),a=m(d)):(r(a,e),g=m(d),a=m(f));c.bind({click:function(){s();var a=v.val();g.call(this,a)}});q(h,a);q(k,a);w(c,k,h,v)}};z.dialog.setup()})(jQuery,window);
